language: node_js
node_js:
- '8'
env:
- CXX=g++-4.8
services:
- redis-server
addons:
  postgresql: '9.4'
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
    - librsvg2-dev
before_install:
- which phantomjs
- phantomjs --version
before_script:
- psql -c 'create database rm3unit;' -U postgres
- psql -c "CREATE USER wirehead WITH PASSWORD 'rm3test';" -U postgres
- psql -c "GRANT ALL PRIVILEGES ON database rm3unit TO wirehead;" -U postgres
- psql -c "ALTER USER wirehead WITH SUPERUSER;" -U postgres
- psql rm3unit < ./db-schema.sql -U postgres
script: npm run travis
before_deploy:
- tar -pczf scheme-default.tar.gz scheme/default/
deploy:
  matrix:
  - provider: npm
    email: wh-npm@wirewd.com
    api_key:
      secure: k0spOkriMkHB3yZH58q1k4nL/Cj6EtU6Ex/Rtr/ksUV/1yHHoQlHVcEM1Brsqlykv84cIsP5DucYjNkJR/7VZ1ZCUSu+UOMOjo1xHW2UbXEO8wKqNhR+GISJQKxnWFXfF3JSO0pF5oMuy1WDp9yHOgb/86OV4hzWlOVzPTEivEcZ2b7760MymVzUR9DuyY6zz6rgEGitCyALWBxJg2BcsBZccKx8YZAidKM5OSnAr2RcBMoOK03pVgrd0quZIs5yzmcrvIz9mCRuyIR6oCSsEgmVg0UZsvVR149Yssbm892x3TljJftnHAryx/F53hfFVEHsmNtWyr3QUXcqbrF0zRxLne3f7zqSXNvLBd+1MuMQfpxC9vFaEFa6s5M9yQPHxU11becGzhv8+hXSIZ4SA/dAqq6wCUUYyH0x3QbQO6mqhmtSBefA2rJm5Rnsn1ZEVIFI2HrfVvJF+jGJhZVkPk+T7NzuSa4XuymvMDCVAAsAE7Ya7k6HV9el4YGcXMoXJTCMYndpXOI5hyOCmzZQfk+Y8bw4WhmXjxHNC+PRv2vMpa1JFQnLQV3YFgzJUQiP1b/TncU2rfwv+Q4cMAUvm+I7QfeSp/iVbWjK2FpWg+7RqA46l5X4Ghzk6ZUlay4AlsM7GM8hD5e0Ym4mPLoAUmbttm6GypTFysns5nBGBRU=
    on:
      tags: true
      repo: rm3web/rm3
      node: '8'
  - provider: releases
    api_key:
      secure: JMDbzxgUgl5C8oo1hJsnvOgHrujNvihw6gCV1HCiWeO0/Qk+nxxf7L6z4mGS2+5C5wXV9qvgSCfjPLnsVTs4pFeRy+23hALGrVcmFgx0bfJC3XlmtdYaHORMv9zK3XMhHMgjVn3m7Xs6mu841Gp/ZbnpP1tiWhH4NMf2TCcyYS5MuJOPgMJn4VveGTWQvoouErsaCbCbtbRfnLMnze9JJFtkkecsiDj5JzkcaTY3qOh2BXPUdoRuWOYCDxDdMfOSNr7EYF+dTpp5zwtj3/KRJU0V2O0F/Gq+8E3n9zlwC3QqVNUCytttxczTSrmvxhPaYn4lCTocn/7EiqSPZ9p5FQKXM3xTJyD+EKhqffNo49MjK3Fx09tIFGuMyUkjBhJM/84dD94U15ZWSXns+65nUUlVFQRizB/T/J8wvNglJy1Bc90Vae1GaVncl2wd9U6EPuU3IfuvyGhO0CeZhqbaxsSPp55f0crjq8TIWwQcJh2dqg0675oOhOh4ZdyFCbMElfqpMgitbO+3/ggLrT4LRBcxmQqmDTKgoFu5bqQTwHveeQraHe2hSXyMzkNG5JXunG9o467nmg0ZaJGW9twoy1X+EMdPtUgvnLebjwqbkOvr9CYieLhwzsFLuINq8o3vVDgFnV2FqmUC+IKQD9zhVnu7HyMllS173BBmB+4pA2g=
    file: scheme-default.tar.gz
    skip_cleanup: true
    on:
      tags: true
      repo: rm3web/rm3
      node: '8'
cache:
  directories:
  - node_modules
